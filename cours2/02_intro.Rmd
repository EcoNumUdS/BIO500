# Séance 2

- Ces diapositives sont disponibles en [version web](https://econumuds.github.io/BIO500/cours2/) et en [PDF](./assets/pdf/S2-BIO500.pdf).
- L'ensemble du matériel de cours est disponible sur la page du portail [moodle](https://www.usherbrooke.ca/moodle2-cours/course/view.php?id=12189).


--- .transition

# Les données en biologie

---

# La collecte de données

<div style='text-align:center;'>
<img src="assets/img/flow_cours2.png" width="90%"></img>
</div>

--- &twocol

# Le constat

*** =left

Trop souvent en écologie, les données sont représentées et entreposées dans un format proche des analyses que l'on veut réaliser.

Par exemple, on utilise une matrice $sites \times espèces$ pour analyser la structure des communautées.

La question scientifique ne devrait jamais conditionner notre façon de stocker l'information sur un système écologique.

*** =right

<div style='text-align:center;'>
<img src="assets/img/matrix.jpg" width="90%"></img>
</div>


---

# La collecte de données en biologie

## D'abord, qu'est ce qu'une donnée en écologie?


<!-- Présenter qu'est qu'une données biologiques, comme elle est représentée -->
<!-- Qu'est ce qui est représenté en ligne versus en colonne -->


<div style='text-align:center;'>
<img src="assets/img/data_cube_2n.png" width="100%"></img>
</div>


---

# La collecte de données en biologie

## Le problème de multi-dimensionnalité

<div style='text-align:center;'>
<img src="assets/img/data_cube_3n.png" width="100%"></img>
</div>


---

# La collecte de données en biologie

## Le problème de multi-dimensionnalité

<div style='text-align:center;'>
<img src="assets/img/data_cube_4n.png" width="100%"></img>
</div>

**Note:** Pour la prise de données de facteurs environnementaux (abiotiques), on retrouverait une forme de type 3n.

---

# La collecte de données en biologie

## **En biologie**, on classifie les données selon 4 dimensions/classes d'information:

1. Biotique/abiotique
2. Taxonomique
3. Temporelle
4. Spatial

Au sein de ce cours, nous nous attarderons à la façon de structurer ces données. Les spécificités propres à chacune de ces dimensions seront présentées. D'abord le format des données, puis les types de données.

--- .transition

#  Le format des données

--- &twocol

#  Le format des données

*** =right

## <img src="assets/img/green.svg" width="10%"></img> Format long

```{r echo=FALSE}
library("knitr")
ids <- c("567-1","567-2","567-3","598","876")
esp <- c("acsa","acsa","acsa","piru","abba")
annees <- c(2010,2010,2010,2011,2014)
dhp_mm <- c(460,100,120,380,160)
df <- data.frame(ID=ids,esp=esp,annees=annees,dhp_mm=dhp_mm)
kable(df,format="markdown")
```

- Noms de colonnes courts, sans accents, sans espaces et explicites.
- Si possible, attacher les unités au nom de la colonne.

*** =left

## <img src="assets/img/red.svg" width="10%"></img> Format large

```{r echo=FALSE}
library(reshape2)
df2 <- dcast(ids + esp ~ annees, data=df, value.var="dhp_mm")
names(df2)[1] <- "ID"
kable(df2,format="markdown")
```

- Privilégier le format long
- Une ligne = une observation

--- &twocol

#  Le format des données: tableaux

## <img src="assets/img/green.svg" width="40px"></img> Un tableau doit contenir un type d'information

*** =left

```{r echo=FALSE}
ID_plot <- c("A","A","A","B","B")
ids <- c(567,567,567,598,876)
sub_ids <- c(1,2,3,NA,NA)
df <- data.frame(ID_plot=ID_plot,ID_arbre=ids,ID_multi=sub_ids,esp=esp,annees=annees,dhp_mm=dhp_mm)
kable(df,format="markdown")
```

*** =right

```{r echo=FALSE, warnings=FALSE}
clim <- data.frame(ID_plot=c('A','B','B'),annees=c(2010,2011,2014),pp_tot_mm=c(880,560,900),temp_max_deg=c(24,26,28))
kable(melt(clim,id=c("ID_plot",'annees'),value.name="valeur"),format="markdown")
```

- Si l'on veut ajouter des données sur le climat, on ajoutera un nouveau tableau.

--- &twocol

#  Le format des données: colonnes

## <img src="assets/img/green.svg" width="40px"></img> Ne pas agréger l'information dans une seule colonne

*** =left

```{r echo=FALSE}
ids <- c("567-1","567-2","567-3","598","876")
esp <- c("acsa","acsa","acsa","piru","abba")
annees <- c(2010,2010,2010,2011,2014)
dhp_mm <- c(460,100,120,380,160)
df5 <- data.frame(ID_arbre=ids,esp=esp,annees=annees,dhp_mm=dhp_mm)
kable(df5,format="markdown")
```


- Une colonne = une information

*** =right

```{r echo=FALSE}
ids <- c("567","567","567","598","876")
sub_ids <- c("1","2","3",NA,NA)
df <- data.frame(ID_arbre=ids,ID_multi=sub_ids,esp=esp,annees=annees,dhp_mm=dhp_mm)
kable(df,format="markdown")
```

---

#  Le format des données: colonnes

<span style="color:rgb(194, 0, 0);"> Important:</span> votre fichier de données brutes (destiné au stockage à long terme) ne doit pas contenir de champ calculé (c.a.d. une nouvelle colonne avec une moyenne, etc..)


--- .transition

#  Les types de données

---

#  Les types de données en informatique

## **En informatique**, on distingue plusieurs types de données:

| Appelation                | Type                 | Valeurs     | Taille           |
|---------------------------|----------------------|-------------|------------------|
| `BOLEAN`                  | Boléen               | vrai/faux   | 1 octet          |
| `INTEGER`                 | Entiers              | -998, 123   | 1 à 4 octets     |
| `DOUBLE`, `FLOAT`, `REAL` | Nombres réels        | 9.98, -4.34 | 4 à 8 octets     |
| `CHAR`,`VARCHAR`          | Chaine de caractères | lapin       | n x 1 à 8 octets |
| `TIMESTAMP`,`DATE`,`TIME` | Dates et heures      | 1998-02-16  | 4 à 8 octets     |


- Ce sont ces types qui seront utilisés pour entreposer nos données.
- Le choix d'un type approprié permet de réduire la taille du fichier de données.

--- .transition

#  Les données temporelles

---

# Les données temporelles

La plupart des languages/programmes disposent d'un type `TIMESTAMP`, `DATE` et `TIME` pour représenter une donnée temporelle.

On utilisera préférablement la norme [ISO8601](https://fr.wikipedia.org/wiki/ISO_8601) pour représenter ces données.

  - `TIMESTAMP` (Heure et temps): `YYYY-MM-ddThh:mm:ss`. *ex. `1977-04-22T01:00:00-05:00`*
  - `DATE`: `YYYY-MM-dd`. *ex. 1997-04-22*
  - `TIME`: `HH:mm:ss` dans un systéme de 24 heures. *ex. 01:30:00.*

---

# Les données temporelles

 Gardez à l'esprit que vos données pourraient être réutilisées à travers le monde. Les dates ne sont pas représentées de la même manière que l'on soit en Amérique du Nord ou en Europe. **Il est donc important de normaliser la saisie de ce type d'information.**

--- &twocol

# Les données temporelles

Une autre représentation de la date est l'utilisation du calendrier Julien.

*** =left

<div style='text-align:center;'>
<img src="assets/img/jul.jpg" width="105%"></img>
</div>

*** =right

- **Inconvénient:** Le jour julien doit toujours être accompagné de l'année (YYYY).
- **Avantage:** simplifie les analyses temporelles intra-annuelles.

--- .transition

# Les données taxonomiques

--- &twocol

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

*** =left

**Selon vous quelle option est la meilleure?**

```{r echo=FALSE}
way <- c("1. Code spécifique à l'étude","2. Code du ministère","3. Genre et espèce","4. Nom vernaculaire","5. Numéro Taxonomique (TSN - ITIS)")
ex <- c("ACSA","ERS","Acer saccharum","Érable à sucre","28731")
df <- data.frame(Option=way,Exemple=ex)
kable(df,format="markdown")
```

*** =right

<div style='text-align:center;'>
<img src="assets/img/acsa.jpg" height="450px"></img>
</div>


--- &twocol

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

*** =left

```{r echo=FALSE}
kable(df,format="markdown")
```

*** =right

>- <img src="assets/img/red.svg" width="20px"></img> **Option 1 et 2:** Doit être associé à des métadonnées. Risque de perte du fichier attaché.

>- <img src="assets/img/red.svg" width="20px"></img> **Option 3:** Le genre et l'espèce peuvent changer à travers le temps.

>- <img src="assets/img/red.svg" width="20px"></img> **Option 4:** Le nom vernaculaire des espèces est le pire choix. Le nom vernaculaire est propre à un pays, à une région géographique, à une culture/dialecte.


--- &twocol

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

*** =left

```{r echo=FALSE}
library("knitr")
way <- c("1. Code spécifique à l'étude","2. Code du ministère","3. Genre et espèce","4. Nom vernaculaire","5. Numéro Taxonomique (TSN - ITIS)")
ex <- c("ACSA","ERS","Acer saccharum","Érable à sucre","28731")
df <- data.frame(Option=way,Exemple=ex)
kable(df,format="markdown")
```

*** =right


>- <img src="assets/img/green.svg" width="20px"></img> **Option 5:** Cette option couplée à l'option 3, est le meilleur choix.


---

# Les données taxonomiques

## On privilégie généralement l'utilisation de code espèce standardisée:

1. ITIS
2. VASCAN (Plantes vasculaires du Canada)
3. NCBI

**Avantage:** Chacune de ces institutions/infrastructures nous permet de valider et retirer l'ensemble de la classification taxonomique d'une espèce à partir de son code. Même si l'identifiant change (nouvelle classification), nous serons en mesure de trouver le nouvel identifiant taxonomique à partir de l'ancien.

**Exemple:** [https://www.itis.gov/servlet/SingleRpt/SingleRpt?search_topic=TSN&search_value=28731#null](https://www.itis.gov/servlet/SingleRpt/SingleRpt?search_topic=TSN&search_value=28731#null)


--- .transition

# Les données spatiales

---

# Les données spatiales

## Il existe plus de [65 familles de projections géographiques](https://en.wikipedia.org/wiki/List_of_map_projections) pour représenter des coordonnées sur la planète, en voici 3 des plus connues:

<div style='text-align:center;'>
<img src="assets/img/proj.png" height="200px"></img>
</div>

- Il est important de choisir un bon système de projection pour minimiser la déformation spatiale (surtout à nos latitudes)

>- À nos latitudes, on privilégiera l'utilisation d'une projection conique. Les ministères du Québec conseillent généralement l'utilisation d'une [projection conique conforme de Lambert](https://fr.wikipedia.org/wiki/Projection_conique_conforme_de_Lambert).

---

# Les données spatiales

- **Ce qu'il est important de savoir:** des coordonnées spatiales sans système de projection ne veulent strictement rien dire.
- Ainsi, lorsque l'on entrepose des données spatiales, trois colonnes doivent être représentées:
  - La coordonnée en X
  - La coordonnée en Y
  - La projection écrite en texte (voir votre GPS), ou préférablement l'identifiant unique de la projection.

---

# Les données spatiales

## Deux bases de données connues permettent de fournir des identifiants uniques:

1. `EPSG`: *European Petroleum Survey Group.*
2. `SRID`: *Spatial reference system*.

Ces deux identifiants sont généralement identiques et peuvent être trouvés à cette adresse: [http://spatialreference.org/](http://spatialreference.org/)

**Exemple:** [http://spatialreference.org/ref/epsg/2138/](http://spatialreference.org/ref/epsg/2138/)


--- .transition

# L'absence de données

---

#  L'absence de données

## On peut représenter l'absence de données de plusieurs façons:

- Laisser la cellule vide (`NULL`)
- Mettre un `NA` (*Not Available*)
- Mettre un `0`
- Mettre `-9999` dans une colonne numérique

## Selon vous, quel est le choix le plus approprié ?

---

#  Le format des données

## On peut représenter l'absence de données de plusieurs façons:

- Laisser la cellule vide: montre que l'information n'a pas été saisie (un oublie)

>- Mettre un `NA` (*Not Available*): Montre que l'information est réellement absente (car le NA est saisie par un humain).

>- <span style="text-decoration: line-through;"> Mettre un `0` </span>: **JAMAIS** (empêche la distinction entre un vrai d'un faux 0, influence la moyenne)

>- Mettre `-9999` dans une colonne numérique: Ce choix peut être utilisé seulement pour les jeux de données très importants (centaine de Megas-octet), et doit être référencé dans les métadonnées.


---

# Choisir le bon type et format de données

Si l'on ne choisit pas le type de données approprié, cela aura diverses conséquences:

- Des problèmes de performance (ex. : il est plus rapide de faire une recherche sur un nombre que sur une chaîne de caractères)
- Un comportement contraire à celui attendu (ex. : trier sur un nombre stocké comme tel, ou sur un nombre stocké comme une chaîne de caractères ne donnera pas le même résultat)
- L'impossibilité d'utiliser des fonctionnalités propres à un type de données (ex. : stocker une date comme une chaîne de caractères vous prive des nombreuses fonctions temporelles disponibles).

<!-- Point supplémentaire pour les avancées: - Un gaspillage de mémoire (ex. : si vous stockez de toutes petites données dans une colonne faite pour stocker de grosses quantités de données) -->

---

# Finalement...

Pourquoi prendre soins de ces données ?

## Pour en savoir davantage:

- [Broman KW, Woo K (2017) Data organization in spreadsheets. The American Statistician.](http://www.tandfonline.com/doi/abs/10.1080/00031305.2017.1375989)
- [Hart EM, Barmby P, LeBauer D, Michonneau F, Mount S, Mulrooney P, et al. (2016) Ten Simple Rules for Digital Data Storage. PLoS Comput Biol](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005097)
