class: title-slide, middle

<style type="text/css">
  .title-slide {
    background-image: url('../assets/img/bg.jpg');
    background-color: #23373B;
    background-size: contain;
    border: 0px;
    background-position: 600px 0;
    line-height: 1;
  }
</style>

<div class="lab-logo"></div>

# Séance 4

<hr width="65%" align="left" size="0.3" color="orange"></hr>

## Les outils pour la reproductibilité

<hr width="65%" align="left" size="0.3" color="orange" style="margin-bottom:40px;" alt="@Martin Sanchez"></hr>

.instructors[
  **BIO500** - Dominique Gravel
]

---

# Les étapes du travail d'un biologiste

.center[
  <img src="./assets/img/flow_full_repro.png" width="100%"></img>
]

---

# Une situation courante

.pull-left[
## Une situation qui vous est familière:

.font90[
```bash
MonTravailSession/
  |___ data/
        |___ data_01122018.csv
        |___ data_011022018.csv
  |___ rapportVeg_jean_v1_01012018.docx
  |___ rapportVeg_juliette_v1_01012018.docx
  |___ rapportVeg_rémi_v1_04012018.docx
  |___ rapportVeg_rémi_v2_10012018.docx
  |___ rapportFinal_20012018.docx
```
]]

.pull-right[

## le travail d'équipe

Ses difficultées techniques:

- Multi-utilisateurs
- Garder une trace de l'historique de modifications **d'un ensemble de fichiers**
- Revenir aux versions précédentes
- Comparer des versions d'un fichier
]

---

# Systèmes de contrôle existants

## Un exemple avec Dropbox

.center[
![](./assets/img/dropbox.png)
]

---

# Systèmes de contrôle existants

## Un exemple MS Word

.center[
![](./assets/img/word.gif)
]

---
class: inverse, center, middle

# Git: Un système de controle de version pour programmeur

<hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"></hr>

---

# Qu'est ce que Git?

.pull-left[

C'est un système qui permet de suivre l'**ajout** et les **modifications** pour un ensemble de fichier.

**C'est le cahier de lab du programmeur.**

- Logiciel libre soutenu par une large communauté (12 millions d'utilisateurs dans le monde)
- Par défault, Git est installé sur les systèmes d'exploitation Linux et Mac.
- Il peut être installé sur Windows: [https://git-scm.com/download/win](https://git-scm.com/download/win)
]

.pull-right[
  .center[
    <img src="./assets/img/git.png" width="70%"></img>
    <img src="./assets/img/LinusTorvalds.jpg" width="50%"></img>

    Linus Torvalds
  ]
]

---

# Qu'est ce que Git?

Il présente l'avantage d'être extrêmement versatile.

Selon [Alice Bartlett](https://twitter.com/alicebartlett?lang=en), Git vous permet de:

1. Racontez l'histoire de votre projet
2. Voyager dans le temps
3. Expérimentez avec les changements
4. Backup votre travail
5. Collaborer sur des projets

--

Mais le désavantage de fonctionner seulement avec les fichiers "plain text"...

**Question**: Qu'est ce qu'un fichier "plain text"?

---
# Les grandes étapes de git

0. Explorer interface web de github
1. Créer un compte
2. Créer un dépôt 
3. Installer git 
4. Associer un dépôt à RStudio
5. Bien structurer un projet 
6. Enregistrer les modifications 
7. Revenir en arrière 
8. Récupérer les modifications de co-équipiers

---
# 0. Explorer l'interface github

- Aller à la page du cours BIO500[https://github.com/EcoNumUdS/BIO500]

---
# 1. Créer un compte

- Aller à la page D'accueil de gitub[https://github.com]
- Sélectionner "sign up" et entrer les informations

---
# 2. Créer un nouveau projet

- S'inscrire avec "sign in"
- Sélectionner le bouton new pour créer un nouveau dépôt 
- Suivre les instructions 
- On peut changer les options pour avoir un dépôt publique (tous peuvent consulter) ou un dépôt privé (accessible sur invitation seulement)

---
# 2. Créer un nouveau projet
## Le fichier readme.md

- Utilisation du language markdown 
- Décrit le contenu dépôt et son utilisation 
- Permet de spécifier la license et autres informations si nécessaire 
- On peut l'éditer directement en ligne avec le bouton 

---
# 3. Installer git 

Instructions pour Windows[https://git-scm.com/download/win] 

Instructions pour Mac[http://git-scm.com/download/mac] 


**L'interface web est très efficace mais certains pourraient apprécier utiliser un git client pour gérer les fusions, branches et l'historique**

---
# 4. Associer un projet R avec Rstudio

Sur github 

- Cliquer sur le boutone "clone" 
- Copier l'URL du dépôt 

Dans RStudio

- *File > New Project > Version Control > Git*
  + Si cette option n'est pas disponible, consulter l'assistance ici[https://happygitwithr.com/rstudio-see-git.html] 
- Copier l'URL pour cloner le dépôt
- S'assurer de placer le dépôt au bon endroit sur l'ordinateur ! 
- On peut ouvrir le projet ultérieurement avec *File > Open project* en sélectionnant le fichier avec l'extension .Rproj

---
# 5. Bien structurer un projet 

Il est recommandé de bien organiser ses fichiers afin de s'y retrouver plus facilement. On y retrouve habituellement les éléments suivants  : 

- *readme.md*: information sur le dépôt 
- *.Rproj*: informations sur le projet R
- *.git* : informations sur l'historique d'utilisation de git 
- *.gitignore*:  contient les extensions de fichier ignorés par git
- **data** : données du projet ainsi que la base de données
- **scripts**: tous les scripts R
- **figures**: résultats des analyses
- **rapport**: rapport final 

---
# 5. Bien structurer un projet 

Organisez votre répertoire en ajoutant les nouveaux dossiers data, scripts, figures et rapport

---
# 6. Enregistrer des modifications 

- Sélectionner l'onglet git dans le quadrant supérieur droit
- Cliquer sur le bouton "commit" pour enregistrer les modifications
- Résumer les modifications en une courte phrase
- Cliquer sur le bouton "push" pour verser les modifications vers le serveur
- Valider en ligne sur votre page si les modifications ont été ajoutées 

---
# 6. Enregistrer des modifications 


**Exercice**: créer un nouveau script dans le dossier "scripts", inscrire une commande et ensuite enregistrer les modifications 

---
class: inverse, center, middle

# L'histoire d'un projet

<hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"></hr>

---
# L'histoire d'un projet

.pull-left[
## Une situation familière:

.font90[
```bash
MonTravailSession/
  |___ data/
        |___ data_01122018.csv
        |___ data_011022018.csv
  |___ rapportVeg_jean_v1_01012018.docx
  |___ rapportVeg_juliette_v1_01012018.docx
  |___ rapportVeg_rémi_v1_04012018.docx
  |___ rapportVeg_rémi_v2_10012018.docx
  |___ rapportVeg_rémi_v3_12012018.docx
  |___ rapportVeg_rémi_v4_02022018.docx
  |___ rapportFinal_03022018.docx
  |___ rapportFinalVRAIMENT_04022018.docx
```
]]

.pull-right[

## Vous à la fin de ce cours:
```bash
MonTravailSession/
  |___ .git/
  |___ data/
        |___ data_01122018.csv
        |___ data_011022018.csv
  |___ rapportVeg.tex
```
]

---

# Quelques notions de base

.pull-left[
  .center[
    <img src="./assets/img/git_1.png" width="100%"></img>
  ]
]

.pull-right[

- Une branche (`master` par défault): c'est un série de commentaires (`commit`)
- Le dernier commentaire (`commit`) est ce que l'on appelle la tête de la branche (`HEAD`), elle contient la version la plus à jour des fichiers.
- À chaque commentaire d'édition (`commit`) est attachée une version des fichiers.
]

---

# Le journal de Git

```bash
cd Documents/Git/BIO500 # Ceci est mon chemin d'accès
git log
```

```bash
commit 38d4a2700980b9c765f4abdb33e2f6b598aac4d5
Author: Steve Vissault <s.vissault@yahoo.fr>
Date:   Wed Feb 28 20:38:05 2018 -0500

    Modifs sur plan de match

commit 61601ff86e712d0a77ebd24c5277fe55fab9de6e
Author: Steve Vissault <s.vissault@yahoo.fr>
Date:   Wed Feb 28 20:33:20 2018 -0500

    Modifications au cours3 (retrait slides), ajout reponses
```

---

# Le journal de Git

.pull-left[

.font80[
```bash
commit 38d4a2700980b9c765f4abdb33e2f6b598aac4d5
Author: Steve Vissault <s.vissault@yahoo.fr>
Date:   Wed Feb 28 20:38:05 2018 -0500

    Modifs sur plan de match

commit 61601ff86e712d0a77ebd24c5277fe55fab9de6e
Author: Steve Vissault <s.vissault@yahoo.fr>
Date:   Wed Feb 28 20:33:20 2018 -0500

    Modifications au cours3 (retrait slides)
```
]]

.pull-right[
  .center[
    <img src="./assets/img/git_3.png" width="100%"></img>
  ]
]

---

# Se déplacer sur la branche `master`

.pull-left[

```bash
git checkout 4abdb33e2f6b598aac4d5
```

Permet de se déplacer vers un `commit` précis.
]

.pull-right[
  .center[
    <img src="./assets/img/git_3.png" width="100%"></img>
  ]
]

---

# Se déplacer sur la branche `master`

.pull-left[

```bash
git checkout master
```
]

Permet de se déplacer vers le `commit` le plus récent.

.pull-right[
  .center[
    <img src="./assets/img/git_3.png" width="100%"></img>
  ]
]

---
# 7. Revenir en arrière dans le temps

Les commandes de git sont très efficaces et puissantes, elles peuvent néanmoins être fastidieuses et difficiles pour les débutants. 

RStudio facilite ce travail avec un simple onglet "history" et avec un navigateur qui vous permet de passer d'une version à l'autre et de mettre en valeur les modifications qui ont été enregistrées sous forme de commit.


---
# 8. Travailler en équipe 

- git a été spécifiquement créé pour travailler en équipe
- Plusieurs utilisateurs peuvent se connecter au même répertoire et y apporter des modifications 
- À chaque fois que l'on ouvre un projet il est approprié d'utiliser la commande "git pull" (un bouton sur l'interface git de Rstudio) afin de récupérer les modifications des autres membres de l'équipe
- Les restrictions d'utilisation et les invitations peuvent être gérées à partir du site web de github 

---
# La puissance de git

Les fonctionnalités de git sont immenses et RStudio permet de bien les utiliser. 

Un tutoriel complet est disponible ici[https://happygitwithr.com/rstudio-git-github.html]


---
# En résumé

.pull-left[
1.Racontez l'histoire de votre projet
- `git add`
- `git commit`
- `git status`

2.Voyager dans le temps
- `git log`
- `git checkout`

3.Expérimentez avec les changements
- `git branch`
- `git merge`

]
.pull-right[
4.Backup de votre travail & 5. Collaborer sur des projets
- `git remote`
- `git push`
- `git pull`
- `git clone`
]

---

# Lectures

Sandve et al. 2013. Ten Simple Rules for Reproducible Computational
Research. PLoS Computational Biology. 9: e1003285

Silberzahn et Uhlman. 2015. Many hands make tight work. Nature 526 : 189-191.

Barba. 2016. The hard road to reproducibility. Science 354: 142.