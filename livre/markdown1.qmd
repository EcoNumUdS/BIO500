# RMarkdown {#sec-rmd1}

```{r}
#| label: rmd
#| echo: false
#| out-width: 75%
#| fig-cap: |
#|    
#| fig-alt: |
#|   rmd.

knitr::include_graphics("./assets/img/Rmarkdown.png", dpi = 270)
```

Le `RMarkdown` est un outil pour g√©n√©rer des documents pouvant contenir des √©l√©ments de texte, de code et des √©l√©ments visuels tels que des figures. On distingue les fichiers RMarkdown par l'extension `.Rmd` ou `.rmd`. Ces derniers sont des documents dynamiques dans lesquels du code R est imbriqu√©. Le document RMarkdown est un fichier plain text, mais une fois compil√© il produit un document HTML, Word ou PDF.

Le RMarkdown est √©galement une librairie R. Vous aurez d‚Äôabord √† l'installer.

```R
install.packages("rmarkdown")
```

La force du RMarkdown, √† la fa√ßon de [Latex](https://fr.wikipedia.org/wiki/LaTeX) que vous connaissez peut-√™tre, est de s√©parer le contenu de la mise en page des documents produits. Vous verrez que le contenu, le texte, est r√©dig√© en 'plain text' et que des structures s√©par√©es d√©finissent le formatage du document. La r√©daction est ainsi simplifi√©e, le format du document b√©n√©ficie de beaucoup plus de libert√© et le document devient **reproductible** (!).

> Notez que le RMarkdown est un langage compil√©, contrairement √† R qui est interpr√©t√©. C'est-√†-dire, que le fichier RMarkdown doit √™tre "knit" dans sont enti√®ret√© pour produire le document final (html, pdf ou Word).


## Produire un document avec RMarkdown

Pour produire un RMarkdown, il faut :

1. avoir la librairie install√©e sur son ordinateur
2. cr√©er nouveau document RMarkdown √† partir d'un gabarit (New File > RMarkdown)
3. compiler le document (bouton üß∂ knit)

Un document HTML sera sauv√© dans le r√©pertorie de travail et s'affichera automatiquement dans RStudio.


## Anatomie du RMarkdown

```{r}
#| label: rmd_rstudio
#| echo: false
#| out-width: 100%
#| fig-cap: |
#|    
#| fig-alt: |
#|   rmd_rstudio.

knitr::include_graphics("assets/img/Rmarkdown_example.png", dpi = 270)
```

Un fichier RMarkdown est compos√© de 3 structures : une portion YAML, une portion Markdown et des blocs de code. Chacune de ces structures occupe une fonction distincte.

### YAML

Le YAML est toujours situ√© au haut du document et d√©finit les m√©tadonn√©es et les options du document. C'est dans cette section s√©par√©e par `---` √† son d√©but et √† sa fin que les informations sur le document et les param√®tres servant √† la mise en page se trouvent. Les param√®tres suivent la syntaxe cl√©: valeur.

```Markdown
---
title: "Mon titre"
author: "Victor Cameron"
date: "29/03/2022"
output: html_document
---
```

### Markdown

Les portions de texte (le contenu) du document constituent le Markdown. Il s'agit de "plain text" avec une syntaxe minimaliste pour contr√¥ler certains √©l√©ments de la mise en forme du texte.

```Markdown
# Titre 1
## Titre 2
### Titre 3

Ce mot est en *italique* et celui-ci
en **gras**.

Le texte qui suit est une liste :
- Premier item
- Second item
- Troisi√®me item

Pour faire une √©num√©ration : 
1. Item 1
2. Item 2
3. Item 3
```

Ajout d'une image.

```Markdown
![Sch√©ma d'un projet de recherche](chemin/vers/image.png)
```

Hyperlien.

```Markdown
Voici le [lien](https://github.com/EcoNumUdS/BIO500) pour le GitHub du cours BIO500.
```

Une table

```
| Time          | Session  |   Topic |
|:--------------|:--------:|--------:|
| *left*        | *center* | *right* |
| 01:00 - 01:50 |    1     | Anatomy |
| 01:50 - 02:00 |          | *Break* |
| 02:00 - 02:45 |    2     |  Tables |
| 02:45 - 03:00 |          | *Break* |
```

### Blocs de code

Un bloc de code peut √™tre ajout√© au document en s√©lectionnant l'ic√¥ne verte du panneau RStudio. Le code R doit √™tre √† l'int√©rieur d'un bloc de code (*code chunk*). Par exemple:

````md
```{r}`r ''`
data(iris)
iris_setosa <- subset(iris, Species == 'setosa')
head(iris_setosa)
```
````

Ce qui produit une fois le fichier compil√© (knit) :

```{r iris head, echo=FALSE}
data(iris)
iris_setosa <- subset(iris, Species == 'setosa')
head(iris_setosa)
```



Du code peut √™tre ajout√© directement au texte de cette fa√ßon :

```{md code in text}
Le jeu de donn√©es *iris* comprend 
`r length(unique(iris$Species))` esp√®ces avec un total 
de `r nrow(iris)` fleurs mesur√©es.
```

Pour produire ceci :

Le jeu de donn√©es *iris* comprend `r length(unique(iris$Species))` esp√®ces
avec un total de `r nrow(iris)` fleurs mesur√©es.

#### Configuration des code chunk

Une bonne pratique est de nommer les blocs de code. Cela s'av√®re utile pour d√©bogage. Deux blocs de code avec le m√™me nom (label) retourneront un message d'erreur `Duplicate chunk label 'chunk name', which has been used for the chunk`.

Par exemple, on sp√©cifie le nom 'plot_iris' en le sp√©cifiant apr√®s le r dans `{r plot_iris}`.

````md
```{r plot_iris}`r ''`
plot(iris$Sepal.Length, iris$Sepal.Width)
```
````
`echo=FALSE`  affiche les r√©sultats, mais pas le code.
````md
```{r plot_iris, echo=FALSE}`r ''`
plot(iris$Sepal.Length, iris$Sepal.Width)
```
````
`eval=FALSE`  affiche le code sans qu'il ne soit √©valu√©.
````md
```{r plot_iris, eval=FALSE}`r ''`
plot(iris$Sepal.Length, iris$Sepal.Width)
```
````
`include=FALSE` √©value le code, mais rien n'est affich√©.
````md
```{r plot_iris, include=FALSE}`r ''`
plot(iris$Sepal.Length, iris$Sepal.Width)
```
````

Toutes les options de configuration des code chunk sont retourn√©es par :

```{r}
str(knitr::opts_chunk$get())
```


### Ajuster la taille d'une figure

````md
```{r plot_iris, fig.height = 3, fig.width = 5, fig.align = "center"}`r ''`
plot(iris$Sepal.Length, iris$Sepal.Width)
```
````

```{r plot_iris, echo=FALSE, fig.height = 4, fig.width = 6, fig.align = "center"}
plot(iris$Sepal.Length, iris$Sepal.Width)
```


## Autres ressources disponibles en ligne :

- R Markdown: The Definitive Guide [https://bookdown.org/yihui/rmarkdown/](https://bookdown.org/yihui/rmarkdown/)
- Cheat sheet [https://raw.githubusercontent.com/rstudio/cheatsheets/main/rmarkdown.pdf](https://raw.githubusercontent.com/rstudio/cheatsheets/main/rmarkdown.pdf)
- RMarkdown gallery [https://rmarkdown.rstudio.com/gallery.html](https://rmarkdown.rstudio.com/gallery.html)
- ResearchDown [https://insileco.github.io/ResearchDown/](https://insileco.github.io/ResearchDown/)


